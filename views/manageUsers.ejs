<script type="text/javascript">
    $(document).on("click", ".open-DeleteUserDialog", function () {
        let userId = $(this).data('id');
        let userName = $(this).data('username');
        $(".modal-footer #userId").val(userId);
        $(".modal-body span").text(userName);
    });

    $(document).on("click", ".open-EditUserDialog", function () {
        let userId = $(this).data('id');
        let firstName = $(this).data('fn');
        let lastName = $(this).data('ln');
        let username = $(this).data('username');
        let timeOut = $(this).data('to');
        $(".modal-body #userId").val(userId);
        $(".modal-body #firstName").val(firstName);
        $(".modal-body #lastName").val(lastName);
        $(".modal-body #username").val(username);
        $(".modal-body #timeOut").val(timeOut);
    });
</script>

<div class="row mt-5 justify-content-md-center">
    <div class="card-body">
        <h1 class="text-center mb-3">
            <i class="fas fa-users-cog"></i> Users Manage Console
        </h1>
        <% include ./partials/messages.ejs %>

        <a href="/menu/manage/allUsers" class="btn btn-secondary mr-1 disabled">
            <i class="fas fa-users"></i> All Users
        </a>
        <a href="/menu/manage/addUser" class="btn btn-secondary">
            <i class="fas fa-user-plus"></i> Add User
        </a>

        <div class="row row-cols-1 row-cols-md-3 g-4">
            <% userList.forEach(function(user) { %>
                <div class="col">
                    <div class="card mt-2">
                        <div class="card-body">
                            <strong>Name:</strong> <%= user.firstName %> <%= user.lastName %><br>
                            <strong>Username:</strong> <%= user.username %><br>
                            <strong>Date Created:</strong> <%= user.created %><br>
                            <strong>Session Time Out:</strong> <%= user.timeOut %><br>
                            <strong>Role:</strong>
                            <% if(user.isAdmin) { %>
                                <p class="text-danger"><i class="fas fa-crown"></i> Admin </p>
                            <% } else { %>
                                <p class="text-primary"> User </p>
                            <% } %>
                            <strong>Activated:</strong>
                            <% if(user.isActivated) { %>
                                <p class="text-danger"><i class="fas fa-fire"></i> Yes </p>
                            <% } else { %>
                                <p class="text-primary"><i class="fas fa-snowflake"></i> No </p>
                            <% } %>
                        </div>
                        <div class="card-footer">

                            <!-- Button trigger edit modal -->
                            <a data-toggle="modal"
                               data-id="<%= user.id %>"
                               data-fn="<%= user.firstName %>"
                               data-ln="<%= user.lastName %>"
                               data-username="<%= user.username %>"
                               data-to="<%= user.timeOut %>"
                               href="#editUserModal"
                               class="open-EditUserDialog btn btn-info mr-1">
                                <i class="fas fa-user-edit"></i> Edit
                            </a>

                            <!-- Button trigger delete modal -->
                            <a data-toggle="modal"
                               data-id="<%= user.id %>"
                               data-username="<%= user.username %>"
                               href="#deleteUserModal"
                               class="open-DeleteUserDialog btn btn-danger">
                                <i class="fas fa-user-times"></i> Delete
                            </a>

                            <!-- Edit Modal -->
                            <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog"
                                 aria-labelledby="editUserModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <!-- Edit Form -->
                                            <form action="/menu/manage/editUserForm" method="POST">
                                                <div class="form-group">
                                                    <label for="firstName">First Name</label>
                                                    <input
                                                            type="text"
                                                            id="firstName"
                                                            name="firstName"
                                                            class="form-control"
                                                            value="firstName"
                                                    />
                                                </div>
                                                <div class="form-group">
                                                    <label for="lastName">Last Name</label>
                                                    <input
                                                            type="text"
                                                            id="lastName"
                                                            name="lastName"
                                                            class="form-control"
                                                            value="lastName"
                                                    />
                                                </div>
                                                <div class="form-group">
                                                    <label for="username">Username</label>
                                                    <input
                                                            type="text"
                                                            id="username"
                                                            name="username"
                                                            class="form-control"
                                                            value="username"
                                                    />
                                                </div>
                                                <div class="form-group">
                                                    <label for="timeOut">Session Time Out</label>
                                                    <input
                                                            type="number"
                                                            id="timeOut"
                                                            name="timeOut"
                                                            class="form-control"
                                                            value="timeOut"
                                                    />
                                                </div>
                                                <div class="form-group">
                                                    <input class="form-group" type="radio" name="isAdmin" id="role1"
                                                           value="false" checked>
                                                    <label class="form-group-label mb-lg-2" for="role1">
                                                        User
                                                    </label>
                                                </div>
                                                <div class="form-group">
                                                    <input class="form-group" type="radio" name="isAdmin" id="role2"
                                                           value="true">
                                                    <label class="form-group-label mb-lg-2" for="role2">
                                                        Admin
                                                    </label>
                                                </div>
                                                <input type="hidden" name="userId" id="userId" value="userId"/>
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                    Discard
                                                </button>
                                                <button type="submit" class="btn btn-info">
                                                    <i class="fas fa-user-edit"></i> Save Changes
                                                </button>
                                            </form>
                                            <!-- End form -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Delete Modal -->
                            <div class="modal fade" id="deleteUserModal" tabindex="-1" role="dialog"
                                 aria-labelledby="deleteUserModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="deleteUserModalLabel">Delete User</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            Are you sure you want to delete <b><span/></b> user?
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                Discard
                                            </button>
                                            <form action="/menu/manage/deleteUserForm" method="POST">
                                                <input type="hidden" name="userId" id="userId" value="userId"/>
                                                <button type="submit" class="btn btn-danger">
                                                    <i class="fas fa-user-times"></i> Yes, Delete
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            <% }) %>
        </div>

        <a href="/menu" class="btn btn-secondary mt-2"><i class="fas fa-undo-alt"></i> Back to menu</a>
    </div>
</div>

