<script type="text/javascript">
    $(document).on("click", ".open-DeleteMemberDialog", function () {
        let id = $(this).data('id');
        let name = $(this).data('name');
        $(".modal-footer #id").val(id);
        $(".modal-footer #name").val(name);
        $(".modal-body span").text(name);

        document.getElementById("delete").disabled = true;

        /* event listener */
        document.getElementsByName("confirm")[0].addEventListener('change', doThing);


        /* function */
        function doThing() {
            if (document.getElementsByName("confirm")[0].value === ('delete ' + name))
                document.getElementById("delete").disabled = false;
        }
    });

    $(document).on("click", ".open-EditMemberDialog", function () {
        let id = $(this).data('id');
        let name = $(this).data('name');
        let email = $(this).data('email');
        let city = $(this).data('city');

        $(".modal-body #id").val(id);
        $(".modal-body #name").val(name);
        $(".modal-body #email").val(email);
        $(".modal-body #city").val(city);

    });
</script>


<div class="row mt-5 justify-content-md-center">
    <div class="card-body">

        <h1 class="text-center mb-3">
            <i class="fas fa-paper-plane"></i> Subscriptions
        </h1>
        <% include ./partials/messages.ejs %>

        <a href="/menu/subs" class="btn btn-secondary mr-1 disabled">
            <i class="fas fa-share-square"></i> All Members
        </a>
        <% if(permissions.cs){ %>
            <a href="/menu/subs/addMember" class="btn btn-secondary">
                <i class="fas fa-plus-circle"></i> Add Member
            </a>
        <% } %>

        <div class="row row-cols-3 row-cols-md-3 g-3">
            <% members.forEach(function(m) { %>
                <div class="col">
                    <div class="card mt-2">
                        <div class="card-body">
                            <strong>Name:</strong> <%= m.name %><br>
                            <strong>Email:</strong> <%= m.email %><br>
                            <strong>City:</strong> <%= m.city %><br>
                            <strong>Movies watched:</strong>
                            <div class="card mt-2">
                                <div class="card-body">
                                    <h6 class="card-title">Movies watched</h6>
                                    <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>

                                    <a href="#" class="card-link">Card link</a>
                                    <a href="#" class="card-link">Another link</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <!-- Button trigger delete modal -->
                            <a data-toggle="modal"
                               data-id="<%= m._id %>"
                               data-name="<%= m.name %>"
                               href="#deleteMemberModal"
                               class="open-DeleteMemberDialog btn btn-danger mr-1 float-right">
                                <i class="fas fa-user-times"></i> Delete
                            </a>

                            <!-- Button trigger edit modal -->
                            <a data-toggle="modal"
                               data-id="<%= m._id %>"
                               data-name="<%= m.name %>"
                               data-email="<%= m.email %>"
                               data-city="<%= m.city %>"
                               href="#editMemberModal"
                               class="open-EditMemberDialog btn btn-info mr-1 float-right">
                                <i class="fas fa-user-edit"></i> Edit
                            </a>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>


    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteMemberModal" tabindex="-1" role="dialog"
     aria-labelledby="deleteMemberModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteMemberModalLabel">Are you absolutely
                    sure?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>This action cannot be undone. This will permanently delete the <b><span/></b>,
                    from the database. </p>
                <p>Please type <b>delete <span/></b> to confirm.</p>
                <input
                        type="text"
                        name="confirm"
                        class="form-control"
                        placeholder="Enter confirmation here"
                />
            </div>
            <div class="modal-footer">
                <form action="/menu/subs/deleteMemberForm" method="POST">
                    <input type="hidden" name="id" id="id" value="id"/>
                    <input type="hidden" name="name" id="name" value="name"/>
                    <button type="submit" id="delete" class="btn btn-block btn-danger">
                        I understand the consequences, delete this member
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editMemberModal" tabindex="-1" role="dialog"
     aria-labelledby="editMemberModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMemberModalLabel">Edit Member</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Edit Form -->
                <form action="/menu/subs/editMemberForm" method="POST">
                    <div class="form-group">
                        <label for="name"><strong>Name</strong></label>
                        <input
                                type="text"
                                id="name"
                                name="name"
                                class="form-control"
                                placeholder="Enter member name"
                        />
                    </div>
                    <div class="form-group">
                        <label for="email"><strong>Email</strong></label>
                        <input
                                type="email"
                                id="email"
                                name="email"
                                class="form-control"
                                placeholder="Enter member email"
                        />
                    </div>
                    <div class="form-group">
                        <label for="city"><strong>City</strong></label>
                        <input
                                type="text"
                                id="city"
                                name="city"
                                class="form-control"
                                placeholder="Enter member city"
                        />
                    </div>

                    <input type="hidden" name="id" id="id" value="id"/>
                    <button type="button" class="btn btn-secondary mr-1 float-right"
                            data-dismiss="modal">
                        Discard
                    </button>
                    <button type="submit" class="btn btn-info mr-1 float-right">
                        <i class="fas fa-edit"></i> Save Changes
                    </button>
                </form>
                <!-- End form -->
            </div>
        </div>
    </div>
</div>